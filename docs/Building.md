# 建库说明

## 一、数据库约束

使用的约束包括 __非空约束__ 、__主键约束__ 和 __唯一性约束__。关于 __外键约束__ , 请在业务层面实现。

> 请不要手动新建或修改数据库约束，在某些情况下可能会导致ObjectQL建库失败。

## 二、数据库修改类型

### 1、表修改
 + 表新建
 + 表重命名：不支持的操作，按表新建处理

> ObjectQL不会操作数据库中存在的、且与模型无关的表。也就是说，表重命名即建新表之后，原始表不会被删除。

### 2、字段修改
 + 新建
 + 重命名：不支持的操作，按字段新建处理
 + 修改类型
 + 扩充大小：指同类型修改
 + 修改非空约束
 + 修改默认值
 + 删除字段

### 3、约束修改
 + 新建
 + 修改约束字段
 + 删除约束

## 三、建库策略

建库策略（BuildingPolicy）包括初始化（Initialize）、模型修正（Modify）和模型升级（Upgrade）三种。

### 1、初始化策略

根据模型定义，在数据库中建立新表的策略。如果发现表已经新建，但模型做出了修改，将会删除旧表，按照最新的模型建立新表，原始数据不会被保留。这是一种简单粗暴的方式。表内的任何修改，包括字段修改和约束修改，都会导致表重建。

这种策略适合在开发前期新建模型的阶段使用。

### 2、模型修正策略

在开发后期，数据表基本成型，已经有了一些测试数据，执行 **初始化策略** 是件很麻烦的事情。 **模型修正策略** 允许在原有的数据表上，做出简单的修改。

允许的操作包括：
 + 新建表
 + 新建字段：提供默认值或允许为空
 + 字段非空修改：在数据不满足非空约束时会执行失败
 + 字段扩充大小
 + 字段修改默认值
 + 修改字段类型：数据表存在数据时会执行失败
 + 删除字段
 + 新建约束或修改约束字段：在数据不满足约束条件时会执行失败
 + 删除约束

 ### 3、模型升级策略

 这种策略适用于系统已上线，库中存在生产数据的情况。这种策略考虑了数据安全的因素，保证系统在升级过程中数据不会丢失。

 这项任务还是交给DBA去干吧，ObjectQL无法保证数据的绝对安全。